@using Test_Login.Models
@using Microsoft.AspNet.Identity
@{
    List<message>
    messageList = ViewBag.messageList;
}

<style>
    .msg {
        border: 2px solid #007bff;
        border-radius: 21px;
        margin: 10px;
        padding: 10px;
    }

    .msginfo {
        height: 50px;
        border-radius: 21px;
        margin: 20px;
        padding: 10px;
    }
    #hashtagBox{
        margin:10px;
        padding:0px;
        height:60px;
    }
    #hashtag > i{
        top:5px;
    }

    #thinking {
        position: relative;
        top: 5px;
    }

    .rpl {
        border: 2px solid #77c8ab;
        margin: 10px;
        border-radius: 21px;
        padding: 10px;
    }

    .torpl {
        border: 2px solid #e48489;
        margin: 10px;
        border-radius: 21px;
        padding: 10px;
    }

    .btnRelpy {
        position: relative;
        display: inline-block;
        height: 30px;
        
        vertical-align: middle;
    }

        .btnRelpy p {
            line-height:0px;
            vertical-align: middle;
        }
    /*Toggle Switch*/
    input[type=checkbox] {
        height: 0;
        width: 0;
        visibility: hidden;
    }

    label {
        width: 20px;
        height: 20px;
        top: 10px;
        display: inline-block;
        border-radius: 10px;
        position: relative;
    }

    hr {
        background-color: gray;
        height: 1px;
        border: none;
    }
</style>

<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
<div class="container center">
    @if (Request.IsAuthenticated)
    {
        <h2>討論區 有登入 @User.Identity.GetUserName() @User.Identity.GetUserId()<span class="pull-right"><button id="newItem" class="btn btn-success btn-sm">發文</button></span></h2>
        <button id="btnName" data-UserName="@User.Identity.GetUserName() " hidden></button>
        @*發文在這*@
        <div class="panel-group">
            @foreach (message message in messageList)
            {
                List<message> articleList = new List<message>();
                if (message.replyID == 0)
                {
                    articleList.Add(message);
                }
                foreach (message article in articleList)
                {
                    //文章區塊
                    <div class="panel panel-primary msg">
                        @*文章頭*@
                        <div class="panel-heading">@article.UserName<span class="pull-right">@article.initDate</span></div>
                        @*文章頭*@
                        <hr />
                        <div class="panel-body">
                            <div class="panel-content">
                                @*文章內文*@
                                @article.main
                                <br />
                            </div>
                            <div class="panel-footer">
                                @*文章使用者有沒有案過讚*@
                                @if (article.wholike.Contains(@User.Identity.GetUserName()))
                                {
                                    @*Toggle Switch*@
                                    <input type="checkbox" class="switch switchHeart" id="heart+@article.messageID" data-UserName="@User.Identity.GetUserName()" data-heart="@article.heart" data-messageID="@article.messageID" onchange="heartChange(this)" checked />
                                    <label for="heart+@article.messageID">
                                        <svg viewBox="0 0 24 24" preserveAspectRatio="xMidYMid meet" focusable="false" class="style-scope yt-icon" style="pointer-events: none; display: block; width: 20px; height: 20px;">
                                            <g id="like+@article.messageID" class="style-scope yt-icon">
                                                <path d="M3,11h3v10H3V11z M18.77,11h-4.23l1.52-4.94C16.38,5.03,15.54,4,14.38,4c-0.58,0-1.14,0.24-1.52,0.65L7,11v10h10.43 c1.06,0,1.98-0.67,2.19-1.61l1.34-6C21.23,12.15,20.18,11,18.77,11z" class="style-scope yt-icon">
                                                </path>
                                            </g>
                                        </svg>
                                    </label>
                                    <span id="heartCnt+@article.messageID" data-heart="@article.heart" data-messageID="@article.messageID">推 @article.heart</span>
                                    @*Toggle Switch*@
                                }
                                else
                                {
                                    @*Toggle Switch*@
                                    <input type="checkbox" class="switch switchHeart" id="heart+@article.messageID" data-UserName="@User.Identity.GetUserName()" data-heart="@article.heart" data-messageID="@article.messageID" onchange="heartChange(this)" />
                                    <label for="heart+@article.messageID">
                                        <svg viewBox="0 0 24 24" preserveAspectRatio="xMidYMid meet" focusable="false" class="style-scope yt-icon" style="pointer-events: none; display: block; width: 20px; height: 20px;">
                                            <g id="like+@article.messageID" class="style-scope yt-icon">
                                                <path d="M18.77,11h-4.23l1.52-4.94C16.38,5.03,15.54,4,14.38,4c-0.58,0-1.14,0.24-1.52,0.65L7,11H3v10h4h1h9.43 c1.06,0,1.98-0.67,2.19-1.61l1.34-6C21.23,12.15,20.18,11,18.77,11z M7,20H4v-8h3V20z M19.98,13.17l-1.34,6 C18.54,19.65,18.03,20,17.43,20H8v-8.61l5.6-6.06C13.79,5.12,14.08,5,14.38,5c0.26,0,0.5,0.11,0.63,0.3 c0.07,0.1,0.15,0.26,0.09,0.47l-1.52,4.94L13.18,12h1.35h4.23c0.41,0,0.8,0.17,1.03,0.46C19.92,12.61,20.05,12.86,19.98,13.17z" class="style-scope yt-icon">
                                                </path>
                                            </g>
                                        </svg>
                                    </label>
                                    <span id="heartCnt+@article.messageID" data-heart="@article.heart" data-messageID="@article.messageID">推 @article.heart</span>
                                    @*Toggle Switch*@
                                }
                                @*文章使用者有沒有案過讚*@
                                @*文章使用者有沒有案過噓*@
                                @if (article.whohate.Contains(@User.Identity.GetUserName()))
                                {
                                    @*Toggle Switch *@
                                    <input type="checkbox" class="switch switchDislike" id="dislike+@article.messageID" data-UserName="@User.Identity.GetUserName()" data-dislike="@article.dislike" data-messageID="@article.messageID" onchange="dislikeChange(this)" checked />
                                    <label for="dislike+@article.messageID">
                                        <svg viewBox="0 0 24 24" preserveAspectRatio="xMidYMid meet" focusable="false" class="style-scope yt-icon" style="pointer-events: none; display: block; width: 20px; height: 20px;">
                                            <g id="hate+@article.messageID" class="style-scope yt-icon">
                                                <path d="M18,4h3v10h-3V4z M5.23,14h4.23l-1.52,4.94C7.62,19.97,8.46,21,9.62,21c0.58,0,1.14-0.24,1.52-0.65L17,14V4H6.57 C5.5,4,4.59,4.67,4.38,5.61l-1.34,6C2.77,12.85,3.82,14,5.23,14z" class="style-scope yt-icon">
                                                </path>
                                            </g>
                                        </svg>
                                    </label>
                                    <span id="dislikeCnt+@article.messageID" data-dislike="@article.dislike" data-messageID="@article.messageID">噓 @article.dislike</span>
                                    @*Toggle Switch *@
                                }
                                else
                                {
                                    @*Toggle Switch*@
                                    <input type="checkbox" class="switch switchDislike" id="dislike+@article.messageID" data-UserName="@User.Identity.GetUserName()" data-dislike="@article.dislike" data-messageID="@article.messageID" onchange="dislikeChange(this)" />
                                    <label for="dislike+@article.messageID">
                                        <svg viewBox="0 0 24 24" preserveAspectRatio="xMidYMid meet" focusable="false" class="style-scope yt-icon" style="pointer-events: none; display: block; width: 20px; height: 20px;">
                                            <g id="hate+@article.messageID" class="style-scope yt-icon">
                                                <path d="M17,4h-1H6.57C5.5,4,4.59,4.67,4.38,5.61l-1.34,6C2.77,12.85,3.82,14,5.23,14h4.23l-1.52,4.94C7.62,19.97,8.46,21,9.62,21 c0.58,0,1.14-0.24,1.52-0.65L17,14h4V4H17z M10.4,19.67C10.21,19.88,9.92,20,9.62,20c-0.26,0-0.5-0.11-0.63-0.3 c-0.07-0.1-0.15-0.26-0.09-0.47l1.52-4.94l0.4-1.29H9.46H5.23c-0.41,0-0.8-0.17-1.03-0.46c-0.12-0.15-0.25-0.4-0.18-0.72l1.34-6 C5.46,5.35,5.97,5,6.57,5H16v8.61L10.4,19.67z M20,13h-3V5h3V13z" class="style-scope yt-icon">
                                                </path>
                                            </g>
                                        </svg>
                                    </label>
                                    <span id="dislikeCnt+@article.messageID" data-dislike="@article.dislike" data-messageID="@article.messageID">噓 @article.dislike</span>
                                    @*Toggle Switch*@
                                }
                                @*文章使用者有沒有案過噓*@
                                <button class="btn btnRelpy btn-outline-dark pull-right " data-messageID="@article.messageID"><p>回覆</p></button>
                            </div>
                            <br />
                            @*文章區塊*@

                            @*回覆區塊*@
                            @foreach (message reply in messageList)
                            {
                                if (reply.replyID == article.messageID)
                                {

                                    <div class="panel panel-info rpl">
                                        @*回覆頭*@
                                        <div class="panel-heading">@reply.UserName<span class="pull-right">@reply.initDate</span></div>
                                        @*回覆頭*@
                                        <hr />
                                        <div class="panel-body">
                                            @*回覆內文*@
                                            <div class="panel-content">
                                                @reply.main
                                                <br />
                                            </div>
                                            @*回覆內文*@
                                            <div class="panel-footer">
                                                @*回覆使用者有沒有案過讚*@
                                                @if (reply.wholike.Contains(@User.Identity.GetUserName()))
                                                {
                                                    @*有案讚*@
                                                    <input type="checkbox" class="switch switchHeart" id="heart+@reply.messageID" data-UserName="@User.Identity.GetUserName()" data-heart="@reply.heart" data-messageID="@reply.messageID" onchange="heartChange(this)" checked />
                                                    <label for="heart+@reply.messageID">
                                                        <svg viewBox="0 0 24 24" preserveAspectRatio="xMidYMid meet" focusable="false" class="style-scope yt-icon" style="pointer-events: none; display: block; width: 20px; height: 20px;">
                                                            <g id="like+@reply.messageID" class="style-scope yt-icon">
                                                                <path d="M3,11h3v10H3V11z M18.77,11h-4.23l1.52-4.94C16.38,5.03,15.54,4,14.38,4c-0.58,0-1.14,0.24-1.52,0.65L7,11v10h10.43 c1.06,0,1.98-0.67,2.19-1.61l1.34-6C21.23,12.15,20.18,11,18.77,11z" class="style-scope yt-icon">
                                                                </path>
                                                            </g>
                                                        </svg>
                                                    </label>
                                                    <span id="heartCnt+@reply.messageID" data-heart="@reply.heart" data-messageID="@reply.messageID">推 @reply.heart</span>
                                                    @*Toggle Switch*@
                                                }
                                                else
                                                {
                                                    @*沒按讚*@
                                                    <input type="checkbox" class="switch switchHeart" id="heart+@reply.messageID" data-UserName="@User.Identity.GetUserName()" data-heart="@reply.heart" data-messageID="@reply.messageID" onchange="heartChange(this)" />
                                                    <label for="heart+@reply.messageID">
                                                        <svg viewBox="0 0 24 24" preserveAspectRatio="xMidYMid meet" focusable="false" class="style-scope yt-icon" style="pointer-events: none; display: block; width: 20px; height: 20px;">
                                                            <g id="like+@reply.messageID" class="style-scope yt-icon">
                                                                <path d="M18.77,11h-4.23l1.52-4.94C16.38,5.03,15.54,4,14.38,4c-0.58,0-1.14,0.24-1.52,0.65L7,11H3v10h4h1h9.43 c1.06,0,1.98-0.67,2.19-1.61l1.34-6C21.23,12.15,20.18,11,18.77,11z M7,20H4v-8h3V20z M19.98,13.17l-1.34,6 C18.54,19.65,18.03,20,17.43,20H8v-8.61l5.6-6.06C13.79,5.12,14.08,5,14.38,5c0.26,0,0.5,0.11,0.63,0.3 c0.07,0.1,0.15,0.26,0.09,0.47l-1.52,4.94L13.18,12h1.35h4.23c0.41,0,0.8,0.17,1.03,0.46C19.92,12.61,20.05,12.86,19.98,13.17z" class="style-scope yt-icon">
                                                                </path>
                                                            </g>
                                                        </svg>
                                                    </label>
                                                    <span id="heartCnt+@reply.messageID" data-heart="@reply.heart" data-messageID="@reply.messageID">推 @reply.heart</span>
                                                    @*Toggle Switch*@
                                                }
                                                @*回覆使用者有沒有案過讚*@
                                                @*回覆使用者有沒有案過噓*@
                                                @if (reply.whohate.Contains(@User.Identity.GetUserName()))
                                                {
                                                    @*Toggle Switch *@
                                                    <input type="checkbox" class="switch switchDislike" id="dislike+@reply.messageID" data-UserName="@User.Identity.GetUserName()" data-dislike="@reply.dislike" data-messageID="@reply.messageID" onchange="dislikeChange(this)" checked />
                                                    <label for="dislike+@reply.messageID">
                                                        <svg viewBox="0 0 24 24" preserveAspectRatio="xMidYMid meet" focusable="false" class="style-scope yt-icon" style="pointer-events: none; display: block; width: 20px; height: 20px;">
                                                            <g id="hate+@reply.messageID" class="style-scope yt-icon">
                                                                <path d="M18,4h3v10h-3V4z M5.23,14h4.23l-1.52,4.94C7.62,19.97,8.46,21,9.62,21c0.58,0,1.14-0.24,1.52-0.65L17,14V4H6.57 C5.5,4,4.59,4.67,4.38,5.61l-1.34,6C2.77,12.85,3.82,14,5.23,14z" class="style-scope yt-icon">
                                                                </path>
                                                            </g>
                                                        </svg>
                                                    </label>
                                                    <span id="dislikeCnt+@reply.messageID" data-dislike="@reply.dislike" data-messageID="@reply.messageID">噓 @reply.dislike</span>
                                                    @*Toggle Switch *@
                                                }
                                                else
                                                {
                                                    @*Toggle Switch*@
                                                    <input type="checkbox" class="switch switchDislike" id="dislike+@reply.messageID" data-UserName="@User.Identity.GetUserName()" data-dislike="@reply.dislike" data-messageID="@reply.messageID" onchange="dislikeChange(this)" />
                                                    <label for="dislike+@reply.messageID">
                                                        <svg viewBox="0 0 24 24" preserveAspectRatio="xMidYMid meet" focusable="false" class="style-scope yt-icon" style="pointer-events: none; display: block; width: 20px; height: 20px;">
                                                            <g id="hate+@reply.messageID" class="style-scope yt-icon">
                                                                <path d="M17,4h-1H6.57C5.5,4,4.59,4.67,4.38,5.61l-1.34,6C2.77,12.85,3.82,14,5.23,14h4.23l-1.52,4.94C7.62,19.97,8.46,21,9.62,21 c0.58,0,1.14-0.24,1.52-0.65L17,14h4V4H17z M10.4,19.67C10.21,19.88,9.92,20,9.62,20c-0.26,0-0.5-0.11-0.63-0.3 c-0.07-0.1-0.15-0.26-0.09-0.47l1.52-4.94l0.4-1.29H9.46H5.23c-0.41,0-0.8-0.17-1.03-0.46c-0.12-0.15-0.25-0.4-0.18-0.72l1.34-6 C5.46,5.35,5.97,5,6.57,5H16v8.61L10.4,19.67z M20,13h-3V5h3V13z" class="style-scope yt-icon">
                                                                </path>
                                                            </g>
                                                        </svg>
                                                    </label>
                                                    <span id="dislikeCnt+@reply.messageID" data-dislike="@reply.dislike" data-messageID="@reply.messageID">噓 @reply.dislike</span>
                                                    @*Toggle Switch*@
                                                }
                                                @*回覆使用者有沒有案過噓*@
                                                <button class="btn btnRelpy btn-outline-dark pull-right " data-messageID="@reply.messageID"><p>回覆</p></button>
                                            </div>
                                            <br />
                                            @foreach (var replyToReply in messageList)
                                            {
                                                if (replyToReply.replyID == reply.messageID)
                                                {
                                                    <div class="panel panel-info torpl">
                                                        <div class="panel-heading">@replyToReply.UserName<span class="pull-right">@replyToReply.initDate</span></div>
                                                        <hr />
                                                        <div class="panel-body">
                                                            <div class="panel-content">
                                                                @replyToReply.main
                                                                <br />
                                                            </div>
                                                            <div class="panel-footer">
                                                                @*回覆使用者有沒有案過讚*@
                                                                @if (replyToReply.wholike.Contains(@User.Identity.GetUserName()))
                                                                {
                                                                    @*Toggle Switch*@
                                                                    <input type="checkbox" class="switch switchHeart" id="heart+@replyToReply.messageID" data-UserName="@User.Identity.GetUserName()" data-heart="@replyToReply.heart" data-messageID="@replyToReply.messageID" onchange="heartChange(this)" checked />
                                                                    <label for="heart+@replyToReply.messageID">
                                                                        <svg viewBox="0 0 24 24" preserveAspectRatio="xMidYMid meet" focusable="false" class="style-scope yt-icon" style="pointer-events: none; display: block; width: 20px; height: 20px;">
                                                                            <g id="like+@replyToReply.messageID" class="style-scope yt-icon">
                                                                                <path d="M3,11h3v10H3V11z M18.77,11h-4.23l1.52-4.94C16.38,5.03,15.54,4,14.38,4c-0.58,0-1.14,0.24-1.52,0.65L7,11v10h10.43 c1.06,0,1.98-0.67,2.19-1.61l1.34-6C21.23,12.15,20.18,11,18.77,11z" class="style-scope yt-icon">
                                                                                </path>
                                                                            </g>
                                                                        </svg>
                                                                    </label>
                                                                    <span id="heartCnt+@replyToReply.messageID" data-heart="@replyToReply.heart" data-messageID="@replyToReply.messageID">推 @replyToReply.heart</span>
                                                                    @*Toggle Switch*@
                                                                }
                                                                else
                                                                {
                                                                    @*Toggle Switch*@
                                                                    <input type="checkbox" class="switch switchHeart" id="heart+@replyToReply.messageID" data-UserName="@User.Identity.GetUserName()" data-heart="@replyToReply.heart" data-messageID="@replyToReply.messageID" onchange="heartChange(this)" />
                                                                    <label for="heart+@replyToReply.messageID">
                                                                        <svg viewBox="0 0 24 24" preserveAspectRatio="xMidYMid meet" focusable="false" class="style-scope yt-icon" style="pointer-events: none; display: block; width: 20px; height: 20px;">
                                                                            <g id="like+@replyToReply.messageID" class="style-scope yt-icon">
                                                                                <path d="M18.77,11h-4.23l1.52-4.94C16.38,5.03,15.54,4,14.38,4c-0.58,0-1.14,0.24-1.52,0.65L7,11H3v10h4h1h9.43 c1.06,0,1.98-0.67,2.19-1.61l1.34-6C21.23,12.15,20.18,11,18.77,11z M7,20H4v-8h3V20z M19.98,13.17l-1.34,6 C18.54,19.65,18.03,20,17.43,20H8v-8.61l5.6-6.06C13.79,5.12,14.08,5,14.38,5c0.26,0,0.5,0.11,0.63,0.3 c0.07,0.1,0.15,0.26,0.09,0.47l-1.52,4.94L13.18,12h1.35h4.23c0.41,0,0.8,0.17,1.03,0.46C19.92,12.61,20.05,12.86,19.98,13.17z" class="style-scope yt-icon">
                                                                                </path>
                                                                            </g>
                                                                        </svg>
                                                                    </label>
                                                                    <span id="heartCnt+@replyToReply.messageID" data-heart="@replyToReply.heart" data-messageID="@replyToReply.messageID">推 @replyToReply.heart</span>
                                                                    @*Toggle Switch*@
                                                                }
                                                                @*回覆使用者有沒有案過讚*@
                                                                @*回覆使用者有沒有案過噓*@
                                                                @if (replyToReply.whohate.Contains(@User.Identity.GetUserName()))
                                                                {
                                                                    @*Toggle Switch *@
                                                                    <input type="checkbox" class="switch switchDislike" id="dislike+@replyToReply.messageID" data-UserName="@User.Identity.GetUserName()" data-dislike="@replyToReply.dislike" data-messageID="@replyToReply.messageID" onchange="dislikeChange(this)" checked />
                                                                    <label for="dislike+@replyToReply.messageID">
                                                                        <svg viewBox="0 0 24 24" preserveAspectRatio="xMidYMid meet" focusable="false" class="style-scope yt-icon" style="pointer-events: none; display: block; width: 20px; height: 20px;">
                                                                            <g id="hate+@replyToReply.messageID" class="style-scope yt-icon">
                                                                                <path d="M18,4h3v10h-3V4z M5.23,14h4.23l-1.52,4.94C7.62,19.97,8.46,21,9.62,21c0.58,0,1.14-0.24,1.52-0.65L17,14V4H6.57 C5.5,4,4.59,4.67,4.38,5.61l-1.34,6C2.77,12.85,3.82,14,5.23,14z" class="style-scope yt-icon">
                                                                                </path>
                                                                            </g>
                                                                        </svg>
                                                                    </label>
                                                                    <span id="dislikeCnt+@replyToReply.messageID" data-dislike="@replyToReply.dislike" data-messageID="@replyToReply.messageID">噓 @replyToReply.dislike</span>
                                                                    @*Toggle Switch *@
                                                                }
                                                                else
                                                                {
                                                                    @*Toggle Switch*@
                                                                    <input type="checkbox" class="switch switchDislike" id="dislike+@replyToReply.messageID" data-UserName="@User.Identity.GetUserName()" data-dislike="@replyToReply.dislike" data-messageID="@replyToReply.messageID" onchange="dislikeChange(this)" />
                                                                    <label for="dislike+@replyToReply.messageID">
                                                                        <svg viewBox="0 0 24 24" preserveAspectRatio="xMidYMid meet" focusable="false" class="style-scope yt-icon" style="pointer-events: none; display: block; width: 20px; height: 20px;">
                                                                            <g id="hate+@replyToReply.messageID" class="style-scope yt-icon">
                                                                                <path d="M17,4h-1H6.57C5.5,4,4.59,4.67,4.38,5.61l-1.34,6C2.77,12.85,3.82,14,5.23,14h4.23l-1.52,4.94C7.62,19.97,8.46,21,9.62,21 c0.58,0,1.14-0.24,1.52-0.65L17,14h4V4H17z M10.4,19.67C10.21,19.88,9.92,20,9.62,20c-0.26,0-0.5-0.11-0.63-0.3 c-0.07-0.1-0.15-0.26-0.09-0.47l1.52-4.94l0.4-1.29H9.46H5.23c-0.41,0-0.8-0.17-1.03-0.46c-0.12-0.15-0.25-0.4-0.18-0.72l1.34-6 C5.46,5.35,5.97,5,6.57,5H16v8.61L10.4,19.67z M20,13h-3V5h3V13z" class="style-scope yt-icon">
                                                                                </path>
                                                                            </g>
                                                                        </svg>
                                                                    </label>
                                                                    <span id="dislikeCnt+@replyToReply.messageID" data-dislike="@replyToReply.dislike" data-messageID="@replyToReply.messageID">噓 @replyToReply.dislike</span>
                                                                    @*Toggle Switch*@
                                                                }
                                                                @*回覆使用者有沒有案過噓*@
                                                            </div>
                                                        </div>
                                                    </div>
                                                }
                                            }
                                            @*<button class="btntest btnHeart+@reply.messageID btn btn-success" id="heart+@reply.messageID" AutoPostBack="true" data-messageID="@reply.messageID" data-heart="@reply.heart" alt="Add Password">推 @reply.heart</button>
                                                <button class="btntest btnDislike+@reply.messageID btn btn-danger" id="dislike+@reply.messageID" AutoPostBack="true" data-messageID="@reply.messageID" data-dislike="@reply.dislike" alt="Add Password">噓 @reply.dislike</button>*@
                                        </div>
                                    </div>
                                }
                            }
                            @*回覆區塊*@
                        </div>
                    </div>
                }
            }
        </div>
        @*發文結束*@
    }
    else
    {
        <h2>討論區 沒登入 @User.Identity.GetUserName() <span class="pull-right"><button id="newItem" class="btn btn-success btn-sm" onclick="login()"> @Html.ActionLink("發文", "Login", "Account")</button></span></h2>
        @*發文在這*@
        <div class="panel-group">
            @foreach (message message in messageList)
            {
                List<message> articleList = new List<message>();
                if (message.replyID == 0)
                {
                    articleList.Add(message);
                }
                foreach (message article in articleList)
                {
                    <div class="panel panel-primary msg">

                        <div class="panel-heading">@article.UserName<span class="pull-right">@article.initDate</span></div>

                        <div class="panel-body">
                            <div class="panel-content">
                                @article.main
                                <br />
                            </div>
                            <div class="panel-footer">
                                @*Toggle Switch*@
                                <input type="checkbox" class="switch switchHeart" id="heart+@article.messageID" data-UserName="@User.Identity.GetUserName()" data-heart="@article.heart" data-messageID="@article.messageID" onchange="heartChange(this)" />
                                <label for="heart+@article.messageID">

                                    @*<span class="switch-txt" turnOn="讚" turnOff="取消"></span>*@
                                </label>
                                <span id="heartCnt+@article.messageID" data-heart="@article.heart" data-messageID="@article.messageID">推 @article.heart</span>
                                @*Toggle Switch*@
                                @*Toggle Switch*@
                                <input type="checkbox" class="switch switchDislike" id="dislike+@article.messageID" />
                                <label for="dislike+@article.messageID">
                                    @*<span class="switch-txt" turnOn="讚" turnOff="取消"></span>*@
                                </label>
                                <span>噓 @article.dislike</span>
                                @*Toggle Switch*@
                                <button class="btn btnRelpy btn-outline-dark pull-right " data-messageID="@article.messageID" onclick="login()">@Html.ActionLink("回覆", "Login", "Account")</button>
                            </div>
                            <br />

                        </div>
                        @*回覆在這*@
                        @foreach (message reply in messageList)
                        {
                            if (reply.replyID == article.messageID)
                            {

                                <div class="panel panel-info rpl">
                                    <div class="panel-heading">@reply.UserName<span class="pull-right">@reply.initDate</span></div>
                                    <div class="panel-body">
                                        <div class="panel-content">
                                            @reply.main
                                            <br />
                                        </div>
                                        <div class="panel-footer">
                                            @*Toggle Switch*@
                                            <input type="checkbox" class="switch switchHeart" id="heart+@reply.messageID" data-UserName="@User.Identity.GetUserName()" data-heart="@reply.heart" data-messageID="@reply.messageID" onchange="heartChange(this)" />
                                            <label for="heart+@reply.messageID"></label>
                                            <span id="heartCnt+@reply.messageID" data-heart="@reply.heart" data-messageID="@reply.messageID">推 @reply.heart</span>
                                            @*Toggle Switch*@
                                            @*Toggle Switch*@
                                            <input type="checkbox" class="switch switchDislike" id="dislike+@reply.messageID" data-UserName="@User.Identity.GetUserName()" data-dislike="@reply.dislike" data-messageID="@reply.messageID" onchange="dislikeChange(this)" />
                                            <label for="dislike+@reply.messageID"></label>
                                            <span id="dislikeCnt+@reply.messageID" data-dislike="@reply.dislike" data-messageID="@reply.messageID">噓 @reply.dislike</span>
                                            @*Toggle Switch*@
                                            <br />
                                            <button class="btn btnRelpy btn-outline-dark pull-right " data-messageID="@reply.messageID">回覆</button>
                                        </div>
                                        @*<button class="btntest btnHeart+@reply.messageID btn btn-success" id="heart+@reply.messageID" AutoPostBack="true" data-messageID="@reply.messageID" data-heart="@reply.heart" alt="Add Password">推 @reply.heart</button>
                                            <button class="btntest btnDislike+@reply.messageID btn btn-danger" id="dislike+@reply.messageID" AutoPostBack="true" data-messageID="@reply.messageID" data-dislike="@reply.dislike" alt="Add Password">噓 @reply.dislike</button>*@
                                    </div>
                                    @foreach (var replyToReply in messageList)
                                    {
                                        if (replyToReply.replyID == reply.messageID)
                                        {
                                            <div class="panel panel-info torpl">
                                                <div class="panel-heading">@replyToReply.UserName<span class="pull-right">@replyToReply.initDate</span></div>
                                                <div class="panel-body">
                                                    <div class="panel-content">
                                                        @replyToReply.main
                                                        <br />
                                                    </div>
                                                    <div class="panel-footer">
                                                        @*Toggle Switch*@
                                                        <input type="checkbox" class="switch switchHeart" id="heart+@replyToReply.messageID" data-UserName="@User.Identity.GetUserName()" data-heart="@replyToReply.heart" data-messageID="@replyToReply.messageID" onchange="heartChange(this)" />
                                                        <label for="heart+@replyToReply.messageID"></label>
                                                        <span id="heartCnt+@replyToReply.messageID" data-heart="@replyToReply.heart" data-messageID="@replyToReply.messageID">推 @replyToReply.heart</span>
                                                        @*Toggle Switch*@
                                                        @*Toggle Switch*@
                                                        <input type="checkbox" class="switch switchDislike" id="dislike+@replyToReply.messageID" data-UserName="@User.Identity.GetUserName()" data-dislike="@replyToReply.dislike" data-messageID="@replyToReply.messageID" onchange="dislikeChange(this)" />
                                                        <label for="dislike+@replyToReply.messageID"></label>
                                                        <span id="dislikeCnt+@replyToReply.messageID" data-dislike="@replyToReply.dislike" data-messageID="@replyToReply.messageID">噓 @replyToReply.dislike</span>
                                                        @*Toggle Switch*@
                                                    </div>
                                                </div>

                                            </div>
                                        }

                                    }
                                </div>

                            }
                        }
                        @*回覆結束*@
                    </div>
                }
            }
        </div>
        @*發文結束*@
    }


    @*<script src="https://cdn.ckeditor.com/4.7.3/standard/ckeditor.js"></script>*@

    <!-- 新增貼文 -->
    <div id="newsModal" class="modal fade" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">發文</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form method="post" action="/Home/Message">
                        <div class="form-group">
                            @*<label for="UserNameBox">*@
                            <span class="glyphicon glyphicon-bullhorn"></span>
                            使用者名稱
                            @*</label>*@
                            <input type="text"
                                   name="UserNameBox"
                                   class="form-control"
                                   placeholder="使用者名稱"
                                   value="@User.Identity.GetUserName()"
                                   readonly />
                        </div>

                        <div class="msginfo" id="hashtagBox">
                            <span class="glyphicon glyphicon-time" id="thinking">想標記個股嗎?</span>
                            <button id="hashtag" type="button" onclick="confirmHashtag()" class="pull-right" style="border:0px; background-color:white; position:relative; display:inline-block">
                                <i class="material-icons" aria-hidden="true">search </i>
                            </button>
                            <input type="text" class="form-control-sm mb-3 pull-right" aria-label="search" id="hashtagStock" placeholder="股票代碼..." aria-invalid="false"  value="" />
                            @*<button type="button" class="btn btn-outline-dark pull-right" id="hashtag">#標個股</button>*@
                        </div>

                        <div class="form-group">
                            @*<label for="mainBox">*@

                            @*</label>*@
                            <input type="text"
                                   id="UserIdbox"
                                   name="UserIdbox"
                                   value="@User.Identity.GetUserName()"
                                   hidden>
                            @*<input type="text"
                                   name="hashtagBox"
                                   id="hashtagBoxid"
                                   value="2603"
                                   hidden>*@
                            <textarea class="form-control"
                                      name="mainBox"
                                      id="exampleFormControlTextarea1"
                                      placeholder="在想些什麼呢?"
                                      rows="3"></textarea>
                        </div>
                        
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">取消</button>
                            <button type="submit" class="btn btn-primary">發文</button>
                        </div>

                    </form>
                </div>

            </div>
        </div>
    </div>
    <!-- 新增貼文 -->
    <!-- 回覆貼文 -->
    <div id="replyModal" class="modal fade" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">回覆</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form method="post" action="/Home/Reply">
                        <div>
                            <input type="text" id="messageID" name="messageID" value="0" hidden />
                        </div>
                        <div class="form-group">
                            @*<label for="UserNameBox">*@
                            <span class="glyphicon glyphicon-bullhorn"></span>
                            使用者名稱
                            @*</label>*@
                            <input type="text"
                                   name="UserNameBox"
                                   class="form-control"
                                   placeholder="使用者名稱"
                                   value="@User.Identity.GetUserName()"
                                   readonly />
                        </div>

                        <div class="form-group">
                            @*<label for="mainBox">*@
                            <span class="glyphicon glyphicon-time"></span>
                            回覆內容
                            @*</label>*@
                            <input type="text"
                                   name="UserIdbox"
                                   value="@User.Identity.GetUserName()"
                                   hidden>
                            <textarea class="form-control"
                                      name="mainBox"
                                      id="exampleFormControlTextarea1"
                                      rows="3"></textarea>
                        </div>

                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">取消</button>
                            <button type="submit" class="btn btn-outline-success ">回覆</button>
                        </div>

                    </form>
                </div>

            </div>
        </div>
    </div>
    <!-- 回覆貼文 -->
</div>
@*<script>CKEDITOR.replace("mainBox");</script>*@
@*<script>CKEDITOR.replace("UserIdbox");</script>*@
<script src="~/Scripts/bootstrap.min.js"></script>
<script src="~/Scripts/jquery-3.4.1.js"></script>
<script src="~/Content/vendor.css"></script>
<script>
    let name = document.getElementById('btnName').dataset.username
    $("#newItem").click(function () {
        $("#newsModal").modal({ backdrop: "static" });
    })

    $(".btnRelpy").click(function () {
        $("#messageID").val(this.dataset.messageid);
        $("#replyModal").modal({ backdrop: "static" });
    })

    $(".btntest").click(function () {
        var message = {
            messageID: 0,
            heart: -1,
            dislike: -1
        }
        message.messageID = this.dataset.messageid;
        message.heart = this.dataset.heart;
        message.dislike = this.dataset.dislike;
        if (message.heart) {
            //alert("true")
            console.log(message.heart);
            console.log(message.dislike);
            console.log('message.heart != -1');
            $.ajax({
                type: "post",
                url: "/Home/APILike",
                data: message
            }).then(function (e) {
                document.getElementById(`heart+${message.messageID}`).innerHTML = `讚 ${e.heart}`;
                document.getElementById(`heart+${message.messageID}`).dataset.heart = e.heart;
            })
        }
        else {
            console.log(message.heart);
            console.log(message.dislike);
            console.log('else');
            //alert("false")
            $.ajax({
                type: "post",
                url: "/Home/APIDislike",
                data: message
            }).then(function (e) {
                document.getElementById(`dislike+${message.messageID}`).innerHTML = `倒讚 ${e.dislike}`;
                document.getElementById(`dislike+${message.messageID}`).dataset.dislike = e.dislike;
            })
        }

    })

    function login() {
        alert("未登入 請先登入!");
    }

    function heartChange(cb) {
        //console.log(cb.dataset.UserName);
        var message = {
            messageID: 0,
            heart: -1,
            dislike: -1,
            UserName: name,
            UserId: name
        }
        if (cb.checked) {
            // 案讚
            //console.log(cb.dataset.heart);
            //console.log(`dislike+${cb.dataset.messageid}`);
            // 案讚且噓是亮的 => 噓改暗的 數字-1
            var cbHate = document.getElementById(`dislike+${cb.dataset.messageid}`);
            if (cbHate.checked == true) {
                cbHate.checked = false;
                // 取消噓
                message.messageID = cbHate.dataset.messageid;
                message.dislike = cbHate.dataset.dislike;
                //console.log(message.UserName);
                $.ajax({
                    type: "post",
                    url: "/Home/APIDislikeCancel",
                    data: message
                }).then(function (e) {
                    document.getElementById(`dislikeCnt+${message.messageID}`).innerHTML = `噓 ${e.dislike}`;
                    document.getElementById(`dislike+${message.messageID}`).dataset.dislike = e.dislike;
                    document.getElementById(`dislikeCnt+${message.messageID}`).dataset.dislike = e.dislike;
                    document.getElementById(`hate+${message.messageID}`).innerHTML = `<path d="M17,4h-1H6.57C5.5,4,4.59,4.67,4.38,5.61l-1.34,6C2.77,12.85,3.82,14,5.23,14h4.23l-1.52,4.94C7.62,19.97,8.46,21,9.62,21 c0.58,0,1.14-0.24,1.52-0.65L17,14h4V4H17z M10.4,19.67C10.21,19.88,9.92,20,9.62,20c-0.26,0-0.5-0.11-0.63-0.3 c-0.07-0.1-0.15-0.26-0.09-0.47l1.52-4.94l0.4-1.29H9.46H5.23c-0.41,0-0.8-0.17-1.03-0.46c-0.12-0.15-0.25-0.4-0.18-0.72l1.34-6 C5.46,5.35,5.97,5,6.57,5H16v8.61L10.4,19.67z M20,13h-3V5h3V13z" class="style-scope yt-icon"></path>`;

                })
            }
            //console.log(cbHate.checked);

            message.messageID = cb.dataset.messageid;
            message.heart = cb.dataset.heart;
            console.log(message.UserName);
            $.ajax({
                type: "post",
                url: "/Home/APILike",
                data: message
            }).then(function (e) {
                document.getElementById(`heartCnt+${message.messageID}`).innerHTML = `推 ${e.heart}`;
                document.getElementById(`heart+${message.messageID}`).dataset.heart = e.heart;
                document.getElementById(`heartCnt+${message.messageID}`).dataset.heart = e.heart;
                document.getElementById(`like+${message.messageID}`).innerHTML = `<path  d="M3,11h3v10H3V11z M18.77,11h-4.23l1.52-4.94C16.38,5.03,15.54,4,14.38,4c-0.58,0-1.14,0.24-1.52,0.65L7,11v10h10.43 c1.06,0,1.98-0.67,2.19-1.61l1.34-6C21.23,12.15,20.18,11,18.77,11z" class="style-scope yt-icon"></path>`;

            })

        } else {
            // 取消讚
            message.messageID = cb.dataset.messageid;
            message.heart = cb.dataset.heart;
            //console.log(message.UserName);
            $.ajax({
                type: "post",
                url: "/Home/APILikeCancel",
                data: message
            }).then(function (e) {
                document.getElementById(`heartCnt+${message.messageID}`).innerHTML = `推 ${e.heart}`;
                document.getElementById(`heart+${message.messageID}`).dataset.heart = e.heart;
                document.getElementById(`heartCnt+${message.messageID}`).dataset.heart = e.heart;
                document.getElementById(`like+${message.messageID}`).innerHTML = `<path  d="M18.77,11h-4.23l1.52-4.94C16.38,5.03,15.54,4,14.38,4c-0.58,0-1.14,0.24-1.52,0.65L7,11H3v10h4h1h9.43 c1.06,0,1.98-0.67,2.19-1.61l1.34-6C21.23,12.15,20.18,11,18.77,11z M7,20H4v-8h3V20z M19.98,13.17l-1.34,6 C18.54,19.65,18.03,20,17.43,20H8v-8.61l5.6-6.06C13.79,5.12,14.08,5,14.38,5c0.26,0,0.5,0.11,0.63,0.3 c0.07,0.1,0.15,0.26,0.09,0.47l-1.52,4.94L13.18,12h1.35h4.23c0.41,0,0.8,0.17,1.03,0.46C19.92,12.61,20.05,12.86,19.98,13.17z" class="style-scope yt-icon"></path>`;
            })
        }
        //console.log(cb.dataset.messageid);

    }

    function dislikeChange(cb) {
        var message = {
            messageID: 0,
            heart: -1,
            dislike: -1,
            UserName: name,
            UserId: name
        }
        if (cb.checked) {
            // 案噓
            //console.log(cb.dataset.heart);
            //console.log(cb.dataset.messageid);
            // 案噓且讚是亮的 => 讚改暗的 數字-1
            var cbLike = document.getElementById(`heart+${cb.dataset.messageid}`);
            if (cbLike.checked == true) {
                cbLike.checked = false;
                // 取消讚
                message.messageID = cbLike.dataset.messageid;
                message.heart = cbLike.dataset.heart;
                //console.log(message.UserName);
                $.ajax({
                    type: "post",
                    url: "/Home/APILikeCancel",
                    data: message
                }).then(function (e) {
                    document.getElementById(`heartCnt+${message.messageID}`).innerHTML = `推 ${e.heart}`;
                    document.getElementById(`heart+${message.messageID}`).dataset.heart = e.heart;
                    document.getElementById(`heartCnt+${message.messageID}`).dataset.heart = e.heart;
                    document.getElementById(`like+${message.messageID}`).innerHTML = `<path  d="M18.77,11h-4.23l1.52-4.94C16.38,5.03,15.54,4,14.38,4c-0.58,0-1.14,0.24-1.52,0.65L7,11H3v10h4h1h9.43 c1.06,0,1.98-0.67,2.19-1.61l1.34-6C21.23,12.15,20.18,11,18.77,11z M7,20H4v-8h3V20z M19.98,13.17l-1.34,6 C18.54,19.65,18.03,20,17.43,20H8v-8.61l5.6-6.06C13.79,5.12,14.08,5,14.38,5c0.26,0,0.5,0.11,0.63,0.3 c0.07,0.1,0.15,0.26,0.09,0.47l-1.52,4.94L13.18,12h1.35h4.23c0.41,0,0.8,0.17,1.03,0.46C19.92,12.61,20.05,12.86,19.98,13.17z" class="style-scope yt-icon"></path>`;
                })
            }
            message.messageID = cb.dataset.messageid;
            message.dislike = cb.dataset.dislike;
            console.log(message.UserName);
            $.ajax({
                type: "post",
                url: "/Home/APIDislike",
                data: message
            }).then(function (e) {
                document.getElementById(`dislikeCnt+${message.messageID}`).innerHTML = `噓 ${e.dislike}`;
                document.getElementById(`dislike+${message.messageID}`).dataset.dislike = e.dislike;
                document.getElementById(`dislikeCnt+${message.messageID}`).dataset.dislike = e.dislike;
                document.getElementById(`hate+${message.messageID}`).innerHTML = `<path d="M18,4h3v10h-3V4z M5.23,14h4.23l-1.52,4.94C7.62,19.97,8.46,21,9.62,21c0.58,0,1.14-0.24,1.52-0.65L17,14V4H6.57 C5.5,4,4.59,4.67,4.38,5.61l-1.34,6C2.77,12.85,3.82,14,5.23,14z" class="style-scope yt-icon"></path>`;

            })

        } else {
            // 取消噓
            message.messageID = cb.dataset.messageid;
            message.dislike = cb.dataset.dislike;
            //console.log(message.UserName);
            $.ajax({
                type: "post",
                url: "/Home/APIDislikeCancel",
                data: message
            }).then(function (e) {
                document.getElementById(`dislikeCnt+${message.messageID}`).innerHTML = `噓 ${e.dislike}`;
                document.getElementById(`dislike+${message.messageID}`).dataset.dislike = e.dislike;
                document.getElementById(`dislikeCnt+${message.messageID}`).dataset.dislike = e.dislike;
                document.getElementById(`hate+${message.messageID}`).innerHTML = `<path d="M17,4h-1H6.57C5.5,4,4.59,4.67,4.38,5.61l-1.34,6C2.77,12.85,3.82,14,5.23,14h4.23l-1.52,4.94C7.62,19.97,8.46,21,9.62,21 c0.58,0,1.14-0.24,1.52-0.65L17,14h4V4H17z M10.4,19.67C10.21,19.88,9.92,20,9.62,20c-0.26,0-0.5-0.11-0.63-0.3 c-0.07-0.1-0.15-0.26-0.09-0.47l1.52-4.94l0.4-1.29H9.46H5.23c-0.41,0-0.8-0.17-1.03-0.46c-0.12-0.15-0.25-0.4-0.18-0.72l1.34-6 C5.46,5.35,5.97,5,6.57,5H16v8.61L10.4,19.67z M20,13h-3V5h3V13z" class="style-scope yt-icon"></path>`;

            })
        }
    }

    function confirmHashtag() {

        var stockid = $("#hashtagStock").val();
        $("#UserIdbox").after(`<input type="text" name = "hashtagBox" id = "hashtagBoxid" value = "${stockid}" hidden >`);
        //$("#hashtagBoxid").val(stockid);
       // alert(stockid);
        $("#hashtagBox").html(`<button type="button" class="btn btn-outline-dark" onclick="cancelHashtag()" width="40px" id="hashtaged" data-hashtag="${stockid}" value="${stockid}">${stockid}</button>`);
        //console.log($("#hashtagBoxid").val());
    }

    function cancelHashtag() {
        $("#hashtagBox").html('<span class="glyphicon glyphicon-time" id="thinking">想標記個股嗎?</span> <button id = "hashtag" type = "button" onclick="confirmHashtag()" class= "pull-right" style = "border:0px; background-color:white; position:relative; display:inline-block" ><i class="material-icons" aria-hidden="true">search </i></button > <input type="text" class="form-control-sm mb-3 pull-right" aria-label="search" id="hashtagStock" placeholder="股票代碼..." aria-invalid="false" value="" />');
    }

</script>
